{include file="/cus/common/script" /}

<style>
    .user-flows {
        padding: 20px;
    }

    .user-flows .user-info {
        background: #fff;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
    }

    .user-flows .user-info-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #409EFF;
    }

    .user-flows .info-row {
        display: inline-block;
        margin-right: 30px;
        margin-bottom: 10px;
    }

    .user-flows .info-label {
        color: #606266;
        margin-right: 8px;
    }

    .user-flows .info-value {
        color: #303133;
        font-weight: 500;
    }

    .user-flows .flow-timeline {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
    }

    .user-flows .timeline-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #409EFF;
    }

    .user-flows .el-timeline-item {
        padding-bottom: 30px;
    }

    .user-flows .step-card {
        background: #F5F7FA;
        padding: 15px;
        border-radius: 6px;
        border-left: 4px solid #409EFF;
    }

    .user-flows .step-card.completed {
        border-left-color: #67C23A;
        background: #F0F9FF;
    }

    .user-flows .step-card.pending {
        border-left-color: #E6A23C;
        background: #FDF6EC;
    }

    .user-flows .step-card.rejected {
        border-left-color: #F56C6C;
        background: #FEF0F0;
    }

    .user-flows .step-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .user-flows .step-name {
        font-size: 15px;
        font-weight: 600;
        color: #303133;
    }

    .user-flows .step-status {
        padding: 3px 10px;
        border-radius: 4px;
        font-size: 12px;
    }

    .user-flows .status-completed {
        color: #67C23A;
        background: #fff;
    }

    .user-flows .status-pending {
        color: #E6A23C;
        background: #fff;
    }

    .user-flows .status-rejected {
        color: #F56C6C;
        background: #fff;
    }

    .user-flows .status-locked {
        color: #909399;
        background: #fff;
    }

    .user-flows .step-detail {
        font-size: 13px;
        color: #606266;
        line-height: 1.8;
    }

    .user-flows .step-detail-row {
        margin-bottom: 5px;
    }

    .user-flows .amount-text {
        color: #F56C6C;
        font-weight: 600;
    }
</style>

<div class="user-flows">
    <!-- 用户信息 -->
    <div class="user-info">
        <div class="user-info-title">用户信息</div>
        <div class="info-row">
            <span class="info-label">用户ID:</span>
            <span class="info-value">{$user->id}</span>
        </div>
        <div class="info-row">
            <span class="info-label">用户名:</span>
            <span class="info-value">{$user->username}</span>
        </div>
        <div class="info-row">
            <span class="info-label">真实姓名:</span>
            <span class="info-value">{$user->realname ?: '-'}</span>
        </div>
        <div class="info-row">
            <span class="info-label">手机号:</span>
            <span class="info-value">{$user->mobile}</span>
        </div>
        {if isset($card)}
        <div class="info-row">
            <span class="info-label">金卡ID:</span>
            <span class="info-value">{$card->id}</span>
        </div>
        <div class="info-row">
            <span class="info-label">当前进度:</span>
            <span class="info-value">步骤{$card->flow_status}</span>
        </div>
        {/if}
    </div>

    <!-- 流程时间线 -->
    <div class="flow-timeline">
        <div class="timeline-title">流程记录（共{$flows ? count($flows) : 0}个步骤）</div>
        
        {if !empty($flows)}
        <el-timeline>
            {volist name="flows" id="flow"}
            <el-timeline-item 
                timestamp="{$flow->createtime|date='Y-m-d H:i:s'}" 
                placement="top"
                :icon="{if $flow->flow_status == 3}CircleCheckFilled{elseif $flow->flow_status == 4/}CircleCloseFilled{elseif $flow->flow_status == 2/}Clock{else/}CircleFilled{/if}"
                :type="{if $flow->flow_status == 3}success{elseif $flow->flow_status == 4/}danger{elseif $flow->flow_status == 2/}warning{else/}info{/if}">
                
                <div class="step-card {if $flow->flow_status == 3}completed{elseif $flow->flow_status == 2/}pending{elseif $flow->flow_status == 4/}rejected{/if}">
                    <div class="step-header">
                        <div class="step-name">步骤{$flow->flow_step}: {$flow->step_name}</div>
                        <div class="step-status {if $flow->flow_status == 3}status-completed{elseif $flow->flow_status == 2/}status-pending{elseif $flow->flow_status == 4/}status-rejected{else/}status-locked{/if}">
                            {if $flow->flow_status == 0}
                            锁定
                            {elseif $flow->flow_status == 1/}
                            未支付
                            {elseif $flow->flow_status == 2/}
                            待审核
                            {elseif $flow->flow_status == 3/}
                            已完成
                            {elseif $flow->flow_status == 4/}
                            审核拒绝
                            {else/}
                            未知状态
                            {/if}
                        </div>
                    </div>
                    
                    <div class="step-detail">
                        <div class="step-detail-row">
                            <strong>支付金额:</strong> <span class="amount-text">¥{$flow->fee_amount}</span>
                        </div>
                        
                        {if $flow->order}
                        <div class="step-detail-row">
                            <strong>订单号:</strong> {$flow->order->order_no}
                        </div>
                        <div class="step-detail-row">
                            <strong>支付方式:</strong> {$flow->order->pay_type ?: '未支付'}
                            {if $flow->order->pay_status == 1}
                            <span style="color: #67C23A;">(已支付)</span>
                            {/if}
                        </div>
                        {if $flow->order->pay_time}
                        <div class="step-detail-row">
                            <strong>支付时间:</strong> {$flow->order->pay_time|date='Y-m-d H:i:s'}
                        </div>
                        {/if}
                        {if $flow->order->transaction_id}
                        <div class="step-detail-row">
                            <strong>交易单号:</strong> {$flow->order->transaction_id}
                        </div>
                        {/if}
                        {/if}
                        
                        {if $flow->extra_data}
                        <div class="step-detail-row">
                            <strong>提交数据:</strong>
                            <pre style="margin-top: 5px; background: #fff; padding: 10px; border-radius: 4px; font-size: 12px;">{$flow->extra_data}</pre>
                        </div>
                        {/if}
                        
                        {if $flow->audit_time}
                        <div class="step-detail-row">
                            <strong>审核时间:</strong> {$flow->audit_time|date='Y-m-d H:i:s'}
                        </div>
                        {/if}
                        
                        {if $flow->audit_remark}
                        <div class="step-detail-row">
                            <strong>审核备注:</strong> {$flow->audit_remark}
                        </div>
                        {/if}
                    </div>
                </div>
            </el-timeline-item>
            {/volist}
        </el-timeline>
        {else/}
        <el-empty description="暂无流程记录"></el-empty>
        {/if}
    </div>
</div>

<script>
    sa.ready(() => {
        // 页面初始化完成
    });
</script>

