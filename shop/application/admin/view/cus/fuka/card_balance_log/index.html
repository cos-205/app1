{include file="/cus/common/script" /}

<div id="index" class="card-balance-log-index panel panel-default panel-intro" v-cloak>
    <el-container class="panel-block">
        <el-header class="sa-header">
            <div class="sa-title sa-flex sa-row-between">
                <div class="sa-title-left">
                    <div class="left-name">余额变动记录</div>
                    <sa-filter-condition v-model="state.filter" @filter-delete="onChangeFilter">
                    </sa-filter-condition>
                </div>
                <div class="sa-title-right">
                    <el-button class="sa-button-refresh" icon="RefreshRight" @click="getData"></el-button>
                    <el-button class="sa-button-refresh" icon="Search" @click="onOpenFilter"></el-button>
                </div>
            </div>
        </el-header>
        <el-main class="sa-main">
            <el-table height="100%" class="sa-table" :data="state.data" stripe @sort-change="onChangeSort">
                <el-table-column prop="id" label="ID" min-width="90" sortable="custom"> </el-table-column>
                <el-table-column label="用户" min-width="120">
                    <template #default="scope">
                        <div v-if="scope.row.user">
                            <div class="sa-table-line-1">{{ scope.row.user.nickname || scope.row.user.username || '-' }}</div>
                            <div class="sa-table-line-1" style="color: #999; font-size: 12px;">ID: {{ scope.row.user_id }}</div>
                        </div>
                        <span v-else>-</span>
                    </template>
                </el-table-column>
                <el-table-column label="金卡" min-width="120">
                    <template #default="scope">
                        <div v-if="scope.row.card">
                            <div class="sa-table-line-1">卡号: {{ scope.row.card.card_no || '-' }}</div>
                        </div>
                        <span v-else>-</span>
                    </template>
                </el-table-column>
                <el-table-column label="变动类型" min-width="100">
                    <template #default="scope">
                        <el-tag :type="scope.row.change_type == 1 ? 'success' : 'danger'">
                            {{ scope.row.change_type_text }}
                        </el-tag>
                    </template>
                </el-table-column>
                <el-table-column label="来源类型" min-width="120">
                    <template #default="scope">
                        {{ scope.row.source_type_text || '-' }}
                    </template>
                </el-table-column>
                <el-table-column label="变动金额" min-width="120" sortable="custom">
                    <template #default="scope">
                        <span :style="{color: scope.row.change_type == 1 ? '#67c23a' : '#f56c6c', fontWeight: 'bold'}">
                            {{ scope.row.change_type == 1 ? '+' : '-' }}¥{{ scope.row.change_money || '0.00' }}
                        </span>
                    </template>
                </el-table-column>
                <el-table-column label="变动前余额" min-width="120" sortable="custom">
                    <template #default="scope">
                        <span>¥{{ scope.row.before_balance || '0.00' }}</span>
                    </template>
                </el-table-column>
                <el-table-column label="变动后余额" min-width="120" sortable="custom">
                    <template #default="scope">
                        <span style="color: #67c23a; font-weight: bold;">¥{{ scope.row.after_balance || '0.00' }}</span>
                    </template>
                </el-table-column>
                <el-table-column label="备注" min-width="150">
                    <template #default="scope">
                        <div class="sa-table-line-1">
                            {{ scope.row.remark || '-' }}
                        </div>
                    </template>
                </el-table-column>
                <el-table-column label="创建时间" width="172" sortable="custom">
                    <template #default="scope">
                        {{ scope.row.createtime || '-' }}
                    </template>
                </el-table-column>
                <el-table-column fixed="right" label="操作" min-width="100">
                    <template #default="scope">
                        <el-button type="primary" link @click="onDetail(scope.row.id)">详情</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </el-main>
        <el-footer class="sa-footer sa-flex sa-row-between sa-flex-wrap">
            <sa-pagination v-model="pagination" @pagination-change="getData"></sa-pagination>
        </el-footer>
    </el-container>
    <sa-filter v-model="state.filter" @filter-change="onChangeFilter"></sa-filter>
</div>
