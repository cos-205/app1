<div class="panel panel-default panel-intro">
    <div class="panel-heading">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#t-all" data-toggle="tab">订单统计</a></li>
        </ul>
    </div>
    <div class="panel-body">
        <!-- 筛选条件 -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">筛选条件</h3>
            </div>
            <div class="panel-body">
                <form id="filter-form" class="form-horizontal" role="form">
                    <input type="hidden" name="addtabs" value="1">
                    <div class="row">
                        <div class="col-xs-12 col-sm-3">
                            <div class="form-group">
                                <label class="control-label">开始时间：</label>
                                <input name="start_time" class="form-control datetimepicker" data-date-format="YYYY-MM-DD HH:mm:ss" data-use-current="true" type="text" value="{$start_time|default=''}" placeholder="选择开始日期">
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-3">
                            <div class="form-group">
                                <label class="control-label">结束时间：</label>
                                <input name="end_time" class="form-control datetimepicker" data-date-format="YYYY-MM-DD HH:mm:ss" data-use-current="true" type="text" value="{$end_time|default=''}" placeholder="选择结束日期">
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-2">
                            <div class="form-group">
                                <label class="control-label">支付状态：</label>
                                <select name="pay_status" class="form-control">
                                    <option value="">全部</option>
                                    <option value="0" {if condition="$pay_status === '0' || $pay_status === 0"}selected{/if}>未支付</option>
                                    <option value="1" {if condition="$pay_status === '1' || $pay_status === 1"}selected{/if}>已支付</option>
                                    <option value="2" {if condition="$pay_status === '2' || $pay_status === 2"}selected{/if}>已退款</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-2">
                            <div class="form-group">
                                <label class="control-label">支付方式：</label>
                                <select name="pay_type" class="form-control">
                                    <option value="">全部</option>
                                    <option value="wechat" {if condition="$pay_type == 'wechat'"}selected{/if}>微信支付</option>
                                    <option value="alipay" {if condition="$pay_type == 'alipay'"}selected{/if}>支付宝</option>
                                    <option value="unionpay" {if condition="$pay_type == 'unionpay'"}selected{/if}>银联支付</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-2">
                            <div class="form-group">
                                <label class="control-label">&nbsp;</label>
                                <div>
                                    <button type="submit" class="btn btn-primary btn-block">
                                        <i class="fa fa-search"></i> 查询
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- 统计卡片 -->
        <div class="row">
            <!-- 总金额 -->
            <div class="col-xs-12 col-sm-6 col-md-3">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">总金额</h3>
                    </div>
                    <div class="panel-body" id="stat-total">
                        <h2 class="text-primary">¥{$total_amount|number_format=2}</h2>
                        <p class="text-muted">总订单数：{$total_count} 笔</p>
                    </div>
                </div>
            </div>
            
            <!-- 今日金额 -->
            <div class="col-xs-12 col-sm-6 col-md-3">
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <h3 class="panel-title">今日金额</h3>
                    </div>
                    <div class="panel-body" id="stat-today">
                        <h2 class="text-success">¥{$today_amount|number_format=2}</h2>
                        <p class="text-muted">今日订单数：{$today_count} 笔</p>
                    </div>
                </div>
            </div>
            
            <!-- 支付成功 -->
            <div class="col-xs-12 col-sm-6 col-md-3">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title">支付成功</h3>
                    </div>
                    <div class="panel-body" id="stat-success">
                        <h2 class="text-info">¥{$success_amount|number_format=2}</h2>
                        <p class="text-muted">成功订单数：{$success_count} 笔</p>
                    </div>
                </div>
            </div>
            
            <!-- 支付失败 -->
            <div class="col-xs-12 col-sm-6 col-md-3">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        <h3 class="panel-title">未支付/失败</h3>
                    </div>
                    <div class="panel-body" id="stat-fail">
                        <h2 class="text-warning">¥{$fail_amount|number_format=2}</h2>
                        <p class="text-muted">失败订单数：{$fail_count} 笔</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 退款统计 -->
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-md-3">
                <div class="panel panel-danger">
                    <div class="panel-heading">
                        <h3 class="panel-title">已退款</h3>
                    </div>
                    <div class="panel-body" id="stat-refund">
                        <h2 class="text-danger">¥{$refund_amount|number_format=2}</h2>
                        <p class="text-muted">退款订单数：{$refund_count} 笔</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 渠道统计 -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">各渠道统计</h3>
            </div>
            <div class="panel-body">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>支付方式</th>
                            <th>订单数</th>
                            <th>总金额</th>
                            <th>占比</th>
                        </tr>
                    </thead>
                    <tbody id="channel-stats-table">
                        {if condition="!empty($channel_stats) && count($channel_stats) > 0"}
                        {volist name="channel_stats" id="item"}
                        <tr>
                            <td>
                                {switch name="item.pay_type"}
                                {case value="wechat"}微信支付{/case}
                                {case value="alipay"}支付宝{/case}
                                {case value="unionpay"}银联支付{/case}
                                {default /}未知
                                {/switch}
                            </td>
                            <td>{$item.count|default=0} 笔</td>
                            <td>¥{$item.total_amount|default=0|number_format=2}</td>
                            <td>{if condition="$total_amount > 0"}{$item.total_amount/$total_amount*100|round=2}%{else /}0%{/if}</td>
                        </tr>
                        {/volist}
                        {else /}
                        <tr>
                            <td colspan="4" class="text-center text-muted">暂无数据</td>
                        </tr>
                        {/if}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 金额分组统计 -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">
                    <i class="fa fa-list"></i> 同金额笔数统计
                    <small class="text-muted">（显示所有金额的订单笔数和总金额）</small>
                </h3>
            </div>
            <div class="panel-body">
                <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                    <table class="table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th width="20%">金额</th>
                                <th width="30%">订单笔数</th>
                                <th width="30%">该金额总金额</th>
                                <th width="20%">占比</th>
                            </tr>
                        </thead>
                        <tbody id="amount-group-table">
                            {if condition="!empty($amount_group) && count($amount_group) > 0"}
                            {volist name="amount_group" id="item"}
                            <tr>
                                <td><strong>¥{$item.amount|default=0|number_format=2}</strong></td>
                                <td><span class="badge badge-primary">{$item.count|default=0} 笔</span></td>
                                <td>¥{$item.total_amount|default=0|number_format=2}</td>
                                <td>{if condition="$total_amount > 0"}{$item.total_amount/$total_amount*100|round=2}%{else /}0%{/if}</td>
                            </tr>
                            {/volist}
                            {else /}
                            <tr>
                                <td colspan="4" class="text-center text-muted">暂无数据</td>
                            </tr>
                            {/if}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.panel {
    margin-bottom: 20px;
}
.panel-body h2 {
    margin: 0;
    font-size: 28px;
    font-weight: bold;
}
.panel-body p {
    margin: 10px 0 0 0;
    font-size: 14px;
}
.table th {
    background-color: #f5f5f5;
    font-weight: bold;
}
.table-responsive {
    max-height: 600px;
    overflow-y: auto;
}
.badge {
    padding: 5px 10px;
    font-size: 13px;
    border-radius: 3px;
}
.badge-info {
    background-color: #5bc0de;
    color: #fff;
}
</style>
